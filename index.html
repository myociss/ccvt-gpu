<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Epithelial Model</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
        <script src="js/plugins/gpu.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/103/three.js"></script>
        <script src="js/plugins/OrbitControls.js"></script>
        <script src="js/plugins/GPUComputationRenderer.js"></script>
        <script src="js/shaders.js"></script>
        <script src="js/ccvt.js"></script>
        <script id="vertexShader" type="x-shader/x-vertex">
            varying vec2 vUv;
           // uniform sampler2D jumpFlood;

            void main() {
                vUv = uv;

                gl_Position =   projectionMatrix * 
                                modelViewMatrix * 
                                vec4(position,1.0);
            }
        </script>
        <script id="vertexReductionShader" type="x-shader/x-vertex">
            varying vec2 vUv;
            //attribute vec4 pixelColor;
            uniform sampler2D pixelPosition;
            attribute vec2 reference;

            void main() {
                vUv = uv;
                gl_PointSize = 1.0;

                vec4 textureColor = texture2D( pixelPosition, reference );
                float seedId = textureColor[3];
               // gl_Position = vec4(seedId, 0, 0, 1.0);
               //gl_Position = vec4(-0.9, -0.9, 0, 1.0);
                
                
               // gl_Position = vec4(position+vec3(-0.3, -0.3, 0), 1.0);
               //gl_Position = vec4(textureColor[2], 0, 0, 1.0);
            }
        </script>
        <script id="vertexReductionFragShader" type="x-shader/x-fragment">
            uniform sampler2D pixelPosition;

            varying vec2 vUv;

            void main() {
                //gl_FragColor = texture2D(pixelPosition, vUv);
                vec4 uvColor = texture2D(pixelPosition, vUv);
                gl_FragColor = vec4(uvColor[0], uvColor[1], uvColor[2], 1.0);
            }
        </script>
        <script id="cubeShader" type="x-shader/x-fragment">
            uniform sampler2D texture1;

            varying vec2 vUv;

            void main() {
                gl_FragColor = texture2D(texture1, vUv);
            }
        </script>

		<script>

            var scene = new THREE.Scene();
            //scene.background = new THREE.Color( 0xff0000 );
            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            var geometry = new THREE.CylinderGeometry( 1, 1, 4, 32, 1, true );
            var numSeeds = 14;

            var res = 256;

            var cubeShader = document.getElementById('cubeShader').textContent;
            var cubeUniforms = {
                texture1: { type: "t", value: null }
            };
            var otherCubeUniforms = {
                texture1: { type: "t", value: null }
            };
            var thirdCubeUniforms = {
                texture1: { type: "t", value: null }
            };
            //ccvt(res, numSeeds);
            var vertShader = document.getElementById('vertexShader').textContent;
            //var fragShader = document.getElementById('voronoiShader').textContent;

            var cubeMaterial = new THREE.ShaderMaterial({
                uniforms: cubeUniforms,
                vertexShader: vertShader,
                fragmentShader: cubeShader
            });

            var otherCubeMaterial = new THREE.ShaderMaterial({
                uniforms: otherCubeUniforms,
                vertexShader: vertShader,
                fragmentShader: cubeShader
            });

            var thirdCubeMaterial = new THREE.ShaderMaterial({
                uniforms: thirdCubeUniforms,
                vertexShader: vertShader,
                fragmentShader: cubeShader
            });

            thirdCubeMaterial.side = THREE.DoubleSide;

            var cube = new THREE.Mesh( geometry, cubeMaterial );
            var otherCube = new THREE.Mesh(geometry, otherCubeMaterial);
            var thirdCube = new THREE.Mesh(geometry, thirdCubeMaterial);

            //scene.add( cube );
            //scene.add(otherCube);
            scene.add(thirdCube);

            //otherCube.translateX(3);
            thirdCube.translateX(-3);

            cubeUniforms["texture1"].value = ccvt(res, numSeeds);
            otherCubeUniforms['texture1'].value = myVar;
            thirdCubeUniforms['texture1'].value = asdf;

            camera.position.z = 10;

            controls = new THREE.OrbitControls( camera, renderer.domElement );
            controls.addEventListener( 'change', render );
            render();

            function render(){
                renderer.render( scene, camera );
            }

		</script>
	</body>
</html>